!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(e){var a=e.fullCalendar,r=a.Promise,t=a.EventSource,n=a.JsonFeedEventSource,o=a.EventSourceParser,l=a.applyAll,i=t.extend({googleCalendarApiKey:null,googleCalendarId:null,googleCalendarError:null,ajaxSettings:null,fetch:function(a,t,o){var i=this,s=this.buildUrl(),d=this.buildRequestParams(a,t,o),c=this.ajaxSettings||{},u=c.success;return d?(this.calendar.pushLoading(),r.construct(function(a,r){e.ajax(e.extend({},n.AJAX_DEFAULTS,c,{url:s,data:d,success:function(t){var n,o;i.calendar.popLoading(),t.error?(i.reportError("Google Calendar API: "+t.error.message,t.error.errors),r()):t.items&&(n=i.gcalItemsToRawEventDefs(t.items,d.timeZone),o=l(u,this,[n].concat(Array.prototype.slice.call(arguments,1))),e.isArray(o)&&(n=o),a(i.parseEventDefs(n)))}}))})):r.reject()},gcalItemsToRawEventDefs:function(e,a){var r=this;return e.map(function(e){return r.gcalItemToRawEventDef(e,a)})},gcalItemToRawEventDef:function(e,a){var r=e.htmlLink||null;return r&&a&&(r=function(e,a){return e.replace(/(\?.*?)?(#|$)/,function(e,r,t){return(r?r+"&":"?")+a+t})}(r,"ctz="+a)),{id:e.id,title:e.summary,start:e.start.dateTime||e.start.date,end:e.end.dateTime||e.end.date,url:r,location:e.location,description:e.description}},buildUrl:function(){return i.API_BASE+"/"+encodeURIComponent(this.googleCalendarId)+"/events?callback=?"},buildRequestParams:function(a,r,t){var n,o=this.googleCalendarApiKey||this.calendar.opt("googleCalendarApiKey");return o?(a.hasZone()||(a=a.clone().utc().add(-1,"day")),r.hasZone()||(r=r.clone().utc().add(1,"day")),n=e.extend(this.ajaxSettings.data||{},{key:o,timeMin:a.format(),timeMax:r.format(),singleEvents:!0,maxResults:9999}),t&&"local"!==t&&(n.timeZone=t.replace(" ","_")),n):(this.reportError("Specify a googleCalendarApiKey. See http://fullcalendar.io/docs/google_calendar/"),null)},reportError:function(e,r){var t=this.calendar,n=t.opt("googleCalendarError"),o=r||[{message:e}];this.googleCalendarError&&this.googleCalendarError.apply(t,o),n&&n.apply(t,o),a.warn.apply(null,[e].concat(r||[]))},getPrimitive:function(){return this.googleCalendarId},applyManualStandardProps:function(e){var a=t.prototype.applyManualStandardProps.apply(this,arguments),r=e.googleCalendarId;return null==r&&e.url&&(r=function(e){var a;if(/^[^\/]+@([^\/\.]+\.)*(google|googlemail|gmail)\.com$/.test(e))return e;if((a=/^https:\/\/www.googleapis.com\/calendar\/v3\/calendars\/([^\/]*)/.exec(e))||(a=/^https?:\/\/www.google.com\/calendar\/feeds\/([^\/]*)/.exec(e)))return decodeURIComponent(a[1])}(e.url)),null!=r&&(this.googleCalendarId=r,a)},applyMiscProps:function(a){this.ajaxSettings||(this.ajaxSettings={}),e.extend(this.ajaxSettings,a)}});i.API_BASE="https://www.googleapis.com/calendar/v3/calendars",i.defineStandardProps({url:!1,googleCalendarId:!1,googleCalendarApiKey:!0,googleCalendarError:!0}),i.parse=function(e,a){var r;return"object"==typeof e?r=e:"string"==typeof e&&(r={url:e}),!!r&&t.parse.call(this,r,a)},o.registerClass(i),a.GcalEventSource=i});